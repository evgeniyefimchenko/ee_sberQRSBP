# CS-Cart Модуль: Интеграция с SberPay QR

## Описание

Этот модуль предназначен для интеграции платформы CS-Cart с SberPay QR и Системой Быстрых Платежей (СБП). Модуль позволяет принимать оплату по QR-коду, а также автоматически обрабатывать статусы платежей.
Модуль интегрирует возможность оплаты только в административной части сайта!
## Установка и настройка

### Шаг 1: Подключение и получение необходимых учётных данных

1. Зарегистрируйтесь на сайте [Sber Developer Portal](https://api.developer.sber.ru/). Для автоматического создания Организации рекомендуется использовать СберБизнесID. В противном случае зарегистрируйтесь через e-mail и создайте Организацию вручную. [Подробнее о СберБизнесID](https://api.developer.sber.ru/how-to-use/sberbusiness_id).
2. После успешной регистрации договора получите параметр `id_qr`.
3. Отправьте анкету на [support@ecom.sberbank.ru](mailto:support@ecom.sberbank.ru), указав метод регистрации.
4. После регистрации анкеты получите `member_id` от технической поддержки.
5. Если регистрация осуществлялась через e-mail, переключитесь в режим Организации и привяжите договор.
6. Создайте приложение и получите сертификат и пароль к нему.
7. Сохраните `ClientId` и `ClientSecret` (они отображаются один раз).
8. Подпишитесь на тариф "QR-код Продавца SberPay QR и СБП" через каталог API (API v3.0).
9. Отправьте запрос на регистрацию ссылки для получения статуса заказа на [support@ecom.sberbank.ru](mailto:support@ecom.sberbank.ru), указав номер договора и ИНН вашей организации.
10. Настройте модуль в административной панели CS-Cart.

### Шаг 2: Установка модуля

1. Установите модуль стандартными средствами CS-Cart.
2. На вкладке "Общее" заполните все необходимые поля.
3. Загрузите сертификат в корневую папку файловой системы для каждой витрины отдельно (../var/files/1, ../var/files/5) или для всех сразу (../var/files). Сертификат будет пересохранён в формате PEM при первом использовании. В папке сохранения появятся три новых файла:
   - `SBQRcertificate.pem`
   - `SBQRextra_certs.pem`
   - `SBQRprivate_key.pem`
   
   **Важно:** Не удаляйте эти файлы.
4. На вкладке "Метод оплаты" выберите метод, который будет использоваться для оплаты по QR-коду.
5. Обратите внимание, что при изменении статуса оплаты статус заказа не изменится автоматически. Это событие необходимо отслеживать вручную администратором.

## Автоматизация действий модуля

1. Сертификат необходимо обновлять ежегодно. Когда до истечения срока его действия останется месяц, в административной панели появится соответствующее уведомление.
2. Если включена запись логов, файлы старше месяца будут удаляться автоматически.

## Обслуживание

Удаление сертификатов выполняется через файловую систему сайта администратором.

## Поддержка

Если у вас возникли вопросы или проблемы с модулем, пожалуйста, создайте [Issue](https://github.com/evgeniyefimchenko/ee_sberQRSBP/issues) на GitHub или свяжитесь с нами по электронной почте [evgeniy@efimchenko.com](mailto:evgeniy@efimchenko.com)

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности можно найти в файле [LICENSE](LICENSE).
